# Copyright (c) 2021-2026 Project CHIP Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# Auto-generated scripts for harness use only, please review before automation. The endpoints and cluster names are currently set to default

name:
    3.1.11. [TC-DD-1.11] Concatenation - QR Code Onboarding Payload Verification
    [DUT - Commissioner]

PICS:
    - MCORE.ROLE.COMMISSIONER
    - MCORE.DD.QR_COMMISSIONING

config:
    nodeId: 0x12344321
    cluster: "Basic Information"
    endpoint: 0

tests:
    - label: "Note"
      verification: |
          Chip-tool command used below are an example to verify the DUT as commissioner test cases. For certification test, we expect DUT should have a capability or way to run the equivalent command.
      disabled: true

    - label: "Precondition"
      verification: |
          This step is required only for the reference platform(e.g., RPI). Please skip this step when validating with real devices.

          The reference platform advertises only a single QR code, which is not sufficient to validate concatenated QR code onboarding payloads.
          Therefore, the QR code payloads must be manually generated using chip-tool.

          Use the following commands to generate individual QR codes:

          ./chip-tool payload generate-qrcode --discriminator 3840 --setup-pin-code 20202021 --vendor-id 65521 --product-id 32768
          ./chip-tool payload generate-qrcode --discriminator 3841 --setup-pin-code 20202021 --vendor-id 65522 --product-id 32770

          Save the generated QR codes for future validation.

          Example QR code payload: MT:Y.K90-Q000KA0648G00
      disabled: true

    - label:
          "Step 1: Scan QR code using concatenation (which supports the
          commissioning of all the TH devices)"
      PICS: MCORE.DD.CTRL_CONCATENATED_QR_CODE_1
      verification: |

          ./chip-tool payload parse-setup-payload "MT:<payload1>*<payload2>"

          Example: ./chip-tool payload parse-setup-payload "MT:Y.K90-Q000KA0648G00*Y.K9061901KA0648G00"

          Verify the DUT(chip-tool) is able to scan and parse the payloads from concatenated QR code:

          [1768813041.471] [132802:132802] [DL] ChipLinuxStorage::Init: Using KVS config file: /tmp/chip_tool_kvs
          [1768813041.471] [132802:132802] [SPL] Parsing base38Representation: MT:Y.K90-Q000KA0648G00*Y.K9061901KA0648G00
          [1768813041.495] [132802:132802] [SPL] Version:             0
          [1768813041.495] [132802:132802] [SPL] VendorID:            65521
          [1768813041.495] [132802:132802] [SPL] ProductID:           32768
          [1768813041.495] [132802:132802] [SPL] Custom flow:         0    (STANDARD)
          [1768813041.495] [132802:132802] [SPL] Discovery Bitmask:   0x00 (NONE)
          [1768813041.495] [132802:132802] [SPL] Long discriminator:  3840   (0xf00)
          [1768813041.495] [132802:132802] [SPL] Passcode:            20202021
          [1768813041.495] [132802:132802] [SPL] ----------
          [1768813041.495] [132802:132802] [SPL] Version:             0
          [1768813041.495] [132802:132802] [SPL] VendorID:            65522
          [1768813041.495] [132802:132802] [SPL] ProductID:           32770
          [1768813041.495] [132802:132802] [SPL] Custom flow:         0    (STANDARD)
          [1768813041.495] [132802:132802] [SPL] Discovery Bitmask:   0x00 (NONE)
          [1768813041.495] [132802:132802] [SPL] Long discriminator:  3841   (0xf01)
          [1768813041.495] [132802:132802] [SPL] Passcode:            20202021

      disabled: true

    - label:
          "Step 2: Verify the DUT follows the correct order of onboarding the TH
          devices which must be from first to last starting from left to right.
          Example -
          MT:<onboarding-base-38-content_bulb1>*<onboarding-base-38-content_bulb2>*<onboarding-base-38-content_bulb3>*<onboarding-base-38-content_bulb4>
          content_bulb1 gets onboarded first, content_bulb2 gets onboarded
          second and so forth."
      PICS: MCORE.DD.CTRL_CONCATENATED_QR_CODE_1_INORDER
      verification: |
          Verify that the DUT (chip-tool) follows the correct onboarding order for the TH devices, which must proceed from first to last, left to right.

          In this case, the QR code payload Y.K90-Q000KA0648G00 must be onboarded first, followed by Y.K9061901KA0648G00.


          [1768813041.471] [132802:132802] [DL] ChipLinuxStorage::Init: Using KVS config file: /tmp/chip_tool_kvs
          [1768813041.471] [132802:132802] [SPL] Parsing base38Representation: MT:Y.K90-Q000KA0648G00*Y.K9061901KA0648G00
          [1768813041.495] [132802:132802] [SPL] Version:             0
          [1768813041.495] [132802:132802] [SPL] VendorID:            65521
          [1768813041.495] [132802:132802] [SPL] ProductID:           32768
          [1768813041.495] [132802:132802] [SPL] Custom flow:         0    (STANDARD)
          [1768813041.495] [132802:132802] [SPL] Discovery Bitmask:   0x00 (NONE)
          [1768813041.495] [132802:132802] [SPL] Long discriminator:  3840   (0xf00)
          [1768813041.495] [132802:132802] [SPL] Passcode:            20202021
          [1768813041.495] [132802:132802] [SPL] ----------
          [1768813041.495] [132802:132802] [SPL] Version:             0
          [1768813041.495] [132802:132802] [SPL] VendorID:            65522
          [1768813041.495] [132802:132802] [SPL] ProductID:           32770
          [1768813041.495] [132802:132802] [SPL] Custom flow:         0    (STANDARD)
          [1768813041.495] [132802:132802] [SPL] Discovery Bitmask:   0x00 (NONE)
          [1768813041.495] [132802:132802] [SPL] Long discriminator:  3841   (0xf01)
          [1768813041.495] [132802:132802] [SPL] Passcode:            20202021
      disabled: true

    - label:
          "Step 3: Verify the DUT indicates to the user the need to commission
          TH devices one by one by scanning their individual QR codes."
      PICS:
          "!(MCORE.DD.CTRL_CONCATENATED_QR_CODE_1) &&
          MCORE.DD.CTRL_CONCATENATED_QR_CODE_2"
      verification: |
          The reference platform (Raspberry Pi running sample applications) does not support user-facing commissioning flows or QR scanning behavior associated with MCORE.DD.CTRL_CONCATENATED_QR_CODE_2.
          Therefore, this test step is not verifiable on the RPI reference platform.

          This test step can be validated using real Commissioner devices that support user interaction and concatenated QR code handling when
          !(MCORE.DD.CTRL_CONCATENATED_QR_CODE_1) && MCORE.DD.CTRL_CONCATENATED_QR_CODE_2.
      disabled: true

    - label:
          "Step 4: Verify the DUT does NOT indicate to the user the need to
          commission TH devices one by one by scanning their individual QR
          codes, but instead warns the user (in a way described by the provider
          of the DUT) that the QR code cannot be processed."
      PICS:
          "!(MCORE.DD.CTRL_CONCATENATED_QR_CODE_1) &&
          !(MCORE.DD.CTRL_CONCATENATED_QR_CODE_2)"
      verification: |
          The reference platform (Raspberry Pi running sample applications) does not support user-facing commissioning flows or QR scanning behavior associated with MCORE.DD.CTRL_CONCATENATED_QR_CODE_2.
          Therefore, this test step is not verifiable on the RPI reference platform.

          This test step can be validated using real Commissioner devices that support user interaction and concatenated QR code handling when
          !(MCORE.DD.CTRL_CONCATENATED_QR_CODE_1) && !MCORE.DD.CTRL_CONCATENATED_QR_CODE_2.
      disabled: true

    - label:
          "Step 5: Scan QR code using concatenation (which supports the
          commissioning of all the TH devices)"
      verification: |
          ./chip-tool payload parse-setup-payload "MT:<payload1>*<payload2>"

          Example: ./chip-tool payload parse-setup-payload "MT:Y.K90-Q000KA0648G00*Y.K9061901KA0648G00"

          Verify the DUT(chip-tool) recognizes the * separator from the QR code as an indication concatenation is used by parsing the QR code successfully as multiple TH QR codes.

          [1768813041.471] [132802:132802] [DL] ChipLinuxStorage::Init: Using KVS config file: /tmp/chip_tool_kvs
          [1768813041.471] [132802:132802] [SPL] Parsing base38Representation: MT:Y.K90-Q000KA0648G00*Y.K9061901KA0648G00
          [1768813041.495] [132802:132802] [SPL] Version:             0
          [1768813041.495] [132802:132802] [SPL] VendorID:            65521
          [1768813041.495] [132802:132802] [SPL] ProductID:           32768
          [1768813041.495] [132802:132802] [SPL] Custom flow:         0    (STANDARD)
          [1768813041.495] [132802:132802] [SPL] Discovery Bitmask:   0x00 (NONE)
          [1768813041.495] [132802:132802] [SPL] Long discriminator:  3840   (0xf00)
          [1768813041.495] [132802:132802] [SPL] Passcode:            20202021
          [1768813041.495] [132802:132802] [SPL] ----------
          [1768813041.495] [132802:132802] [SPL] Version:             0
          [1768813041.495] [132802:132802] [SPL] VendorID:            65522
          [1768813041.495] [132802:132802] [SPL] ProductID:           32770
          [1768813041.495] [132802:132802] [SPL] Custom flow:         0    (STANDARD)
          [1768813041.495] [132802:132802] [SPL] Discovery Bitmask:   0x00 (NONE)
          [1768813041.495] [132802:132802] [SPL] Long discriminator:  3841   (0xf01)
          [1768813041.495] [132802:132802] [SPL] Passcode:            20202021

      disabled: true
